<div class="max-w-4xl mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">📚 My Course Progress</h2>

  <!-- Course Dropdown -->
  <div class="mb-6">
    <label for="course" class="block text-sm font-medium text-gray-700 mb-1">Select Course</label>
    <select [(ngModel)]="selectedCourseId" (change)="loadProgress()" class="w-full border rounded px-3 py-2">
      <option value="">-- Choose a course --</option>
      <option *ngFor="let c of courses" [value]="c._id">{{ c.title }}</option>
    </select>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-gray-500 mb-4">Loading progress...</div>

<!-- Overall Progress -->
<div *ngIf="percentComplete > 0" class="mb-4">
    <div class="text-sm font-medium text-gray-700 mb-1">Overall Progress: {{ percentComplete }}%</div>
    <div class="w-full h-4 bg-gray-200 rounded">
      <div class="h-full bg-green-500 rounded" [style.width.%]="percentComplete"></div>
    </div>
  </div>

  <div *ngIf="percentComplete === 100" class="text-green-600 font-semibold mt-1">
  🎉 You’ve completed this course!
</div>

  <!-- Structure -->
  <div *ngIf="structure.length > 0">
    <div *ngFor="let sec of structure" class="mb-6 border-b pb-4">
      <h3 class="text-lg font-semibold text-blue-600 mb-2">{{ sec.title }}</h3>
      <ul class="space-y-2 pl-4">
        <li *ngFor="let mat of sec.materials" class="flex justify-between items-center text-sm text-gray-700">
            <div>
              <b>{{ mat.title }} ({{ mat.type }})</b>
              <a *ngIf="mat.type === 'file'" [href]="'http://localhost:5000/api/materials/' + mat._id + '/download'" download class="text-blue-500 ml-2">Download</a>
              <a *ngIf="mat.type === 'youtube'" [href]="mat.content" target="_blank" class="text-blue-500 ml-2">Watch</a>
          
              <!-- ✅ Show status -->
              <!-- <span *ngIf="isMaterialCompleted(mat._id)" class="text-green-600 ml-2 font-semibold">✅ Done</span>
              <span *ngIf="!isMaterialCompleted(mat._id)" class="text-gray-400 ml-2">❌ Not done</span> -->
            </div>
          
            <app-progress-toggle [courseId]="selectedCourseId" [materialId]="mat._id"></app-progress-toggle>
          </li>
          
      </ul>
    </div>
  </div>

  <div *ngIf="!loading && structure.length === 0 && selectedCourseId" class="text-gray-500">
    No structure found or no materials assigned yet.
  </div>
</div>
